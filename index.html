<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë¯¸ë‹ˆê²Œì„</title>
    <meta
      name="description"
      content="QRë¡œ ì ‘ì†í•´ì„œ ë‹¤ ê°™ì´ ì¦ê¸°ëŠ” ë¯¸ë‹ˆê²Œì„(ë°¸ëŸ°ìŠ¤/ë¯¸ì…˜/ì¹­ì°¬ë¹™ê³ /ë£°ë ›)"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0b1020;
        --card: rgba(255, 255, 255, 0.06);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.72);
        --shadow: 0 18px 50px rgba(0, 0, 0, 0.45);
        --radius: 18px;
        --radius2: 14px;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family: "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto,
          Arial, sans-serif;
        color: var(--text);
        background: radial-gradient(1200px 700px at 15% 10%, #1d2a6b, transparent),
          radial-gradient(900px 500px at 90% 15%, #0e5b54, transparent),
          radial-gradient(900px 500px at 50% 95%, #53235c, transparent), var(--bg);
      }

      .container {
        max-width: 980px;
        margin: 0 auto;
        padding: 28px 18px 46px;
      }

      .header {
        margin-bottom: 16px;
      }

      .brand {
        display: flex;
        gap: 14px;
        align-items: center;
      }

      .logo {
        width: 48px;
        height: 48px;
        border-radius: 14px;
        display: grid;
        place-items: center;
        font-weight: 800;
        letter-spacing: -0.03em;
        background: linear-gradient(
          135deg,
          rgba(155, 232, 255, 0.35),
          rgba(182, 255, 167, 0.25)
        );
        border: 1px solid rgba(255, 255, 255, 0.16);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
      }

      h1 {
        font-size: 22px;
        margin: 0;
      }

      .subtitle {
        margin: 4px 0 0;
        color: var(--muted);
        font-size: 13px;
      }

      .card {
        background: linear-gradient(180deg, var(--card), rgba(255, 255, 255, 0.04));
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: var(--shadow);
        border-radius: var(--radius);
        padding: 18px;
        backdrop-filter: blur(10px);
        margin-top: 14px;
      }

      .label {
        font-weight: 700;
        font-size: 13px;
        letter-spacing: -0.01em;
      }

      .hint {
        color: rgba(255, 255, 255, 0.62);
        font-size: 12px;
        margin: 8px 0 0;
        line-height: 1.5;
      }

      textarea {
        width: 100%;
        border-radius: var(--radius2);
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(10, 16, 34, 0.5);
        color: var(--text);
        padding: 10px 12px;
        outline: none;
        resize: vertical;
        line-height: 1.6;
      }

      textarea:focus {
        border-color: rgba(155, 232, 255, 0.5);
        box-shadow: 0 0 0 3px rgba(155, 232, 255, 0.15);
      }

      .btn {
        appearance: none;
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 10px 14px;
        cursor: pointer;
        transition: transform 0.06s ease, background 0.15s ease,
          border-color 0.15s ease;
        font-weight: 700;
      }

      .btn:hover {
        border-color: rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.1);
      }

      .btn:active {
        transform: translateY(1px);
      }

      .btn.primary {
        border-color: rgba(155, 232, 255, 0.4);
        background: linear-gradient(
          135deg,
          rgba(155, 232, 255, 0.22),
          rgba(182, 255, 167, 0.14)
        );
      }

      .btn.big {
        padding: 14px 16px;
        font-size: 15px;
      }

      .btn[disabled] {
        opacity: 0.55;
        cursor: not-allowed;
      }

      .tabs {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 14px;
      }

      .tab {
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 999px;
        cursor: pointer;
        font-weight: 800;
      }

      .tab.isActive {
        border-color: rgba(155, 232, 255, 0.45);
        background: rgba(155, 232, 255, 0.12);
      }

      .panel h2 {
        margin: 0 0 8px;
        font-size: 18px;
      }

      .hidden {
        display: none !important;
      }

      .qaCard {
        border-radius: var(--radius);
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.05);
        padding: 14px;
      }

      .counter {
        color: rgba(255, 255, 255, 0.65);
        font-size: 12px;
      }

      .question {
        margin-top: 10px;
        font-size: 18px;
        font-weight: 800;
        line-height: 1.5;
        letter-spacing: -0.02em;
      }

      .twoCols {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
        margin-top: 12px;
      }

      @media (min-width: 760px) {
        .twoCols {
          grid-template-columns: 1fr 1fr;
        }
      }

      .actions {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        margin-top: 12px;
      }

      .bingoGrid {
        margin-top: 12px;
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
      }

      .bingoCell {
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(10, 16, 34, 0.35);
        padding: 10px 10px;
        min-height: 72px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-weight: 700;
        line-height: 1.35;
        user-select: none;
      }

      .bingoCell.isMarked {
        border-color: rgba(182, 255, 167, 0.5);
        background: rgba(182, 255, 167, 0.12);
      }

      .rouletteWrap {
        display: grid;
        gap: 14px;
        grid-template-columns: 1fr;
      }

      @media (min-width: 860px) {
        .rouletteWrap {
          grid-template-columns: 360px 1fr;
          align-items: start;
        }
      }

      .rouletteControls .field {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .resultBox {
        margin-top: 10px;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.05);
        padding: 10px 12px;
        min-height: 42px;
        display: flex;
        align-items: center;
        color: rgba(255, 255, 255, 0.82);
        font-weight: 800;
      }

      .footer {
        margin-top: 16px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 12px;
        line-height: 1.5;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <header class="header">
        <div class="brand">
          <div class="logo" aria-hidden="true">ğŸ²</div>
          <div>
            <h1>ë¯¸ë‹ˆê²Œì„</h1>
            <p class="subtitle">QRë¡œ ì ‘ì†í•´ì„œ ë‹¤ ê°™ì´ ì¦ê²¨ìš” (ì •ì  í˜ì´ì§€ 1ì¥)</p>
          </div>
        </div>
      </header>

      <section class="card">
        <nav class="tabs" aria-label="ê²Œì„ ì„ íƒ">
          <button class="tab isActive" data-tab="balance" type="button">ë°¸ëŸ°ìŠ¤</button>
          <button class="tab" data-tab="mission" type="button">ë¯¸ì…˜</button>
          <button class="tab" data-tab="bingo" type="button">ì¹­ì°¬ë¹™ê³ </button>
          <button class="tab" data-tab="roulette" type="button">ë£°ë ›</button>
        </nav>

        <section id="tab-balance" class="panel" aria-labelledby="ë°¸ëŸ°ìŠ¤">
          <h2>ë°¸ëŸ°ìŠ¤ ê²Œì„</h2>
          <p class="hint">ë‹¤ ê°™ì´ A/B ì¤‘ í•˜ë‚˜ë¥¼ ê³ ë¥´ê³  ì´ìœ ë¥¼ ë§í•´ìš”.</p>
          <div class="qaCard">
            <div id="balanceCounter" class="counter">-</div>
            <div id="balanceQuestion" class="question">-</div>
            <div class="twoCols">
              <button id="balanceA" class="btn primary big" type="button">A</button>
              <button id="balanceB" class="btn primary big" type="button">B</button>
            </div>
          </div>
          <div class="actions">
            <button id="balancePrev" class="btn" type="button">ì´ì „</button>
            <button id="balanceNext" class="btn" type="button">ë‹¤ìŒ</button>
            <button id="balanceShuffle" class="btn" type="button">ì´ íƒ­ë§Œ ë‹¤ì‹œ ì„ê¸°</button>
          </div>
        </section>

        <section id="tab-mission" class="panel hidden" aria-labelledby="ë¯¸ì…˜">
          <h2>ë¯¸ì…˜ ë½‘ê¸°</h2>
          <p class="hint">ëœë¤ ë¯¸ì…˜ì„ ë½‘ê³ , ì„±ê³µí•˜ë©´ ë‹¤ìŒ ì‚¬ëŒ!</p>
          <div class="qaCard">
            <div class="counter">TIP: ë¶€ë‹´ ì—†ëŠ” ë¯¸ì…˜ ìœ„ì£¼</div>
            <div id="missionText" class="question">ë²„íŠ¼ì„ ëˆŒëŸ¬ ë½‘ê¸°</div>
          </div>
          <div class="actions">
            <button id="missionPick" class="btn primary" type="button">ë½‘ê¸°</button>
            <button id="missionAgain" class="btn" type="button">ë‹¤ì‹œ</button>
          </div>
        </section>

        <section id="tab-bingo" class="panel hidden" aria-labelledby="ì¹­ì°¬ë¹™ê³ ">
          <h2>ì¹­ì°¬ ë¹™ê³  (5Ã—5)</h2>
          <p class="hint">
            ëŒì•„ê°€ë©° í•œ ì¹¸ì”© â€œí•´ë‹¹ë˜ëŠ” ì‚¬ëŒâ€ì„ ë§í•˜ê³  ì²´í¬í•´ìš”. ë¨¼ì € ë¹™ê³  ì™„ì„±í•œ ì‚¬ëŒì´
            ìŠ¹ë¦¬!
          </p>
          <div class="actions">
            <button id="bingoResetMarks" class="btn" type="button">ì²´í¬ ì´ˆê¸°í™”</button>
            <button id="bingoRegenerate" class="btn" type="button">ì¹´ë“œ ìƒˆë¡œ ë§Œë“¤ê¸°</button>
          </div>
          <div id="bingoGrid" class="bingoGrid" role="grid" aria-label="ë¹™ê³ íŒ"></div>
        </section>

        <section id="tab-roulette" class="panel hidden" aria-labelledby="ë£°ë ›">
          <h2>ë£°ë ›</h2>
          <p class="hint">
            í•­ëª©ì„ ìˆ˜ì •í•œ ë’¤ ìŠ¤í•€! (ê¸°ë³¸: ê±´ë°°ì‚¬/ì¹­ì°¬/í•œ ì¤„ ì†Œê° ë“±)
          </p>
          <div class="rouletteWrap">
            <canvas id="wheel" width="320" height="320"></canvas>
            <div class="rouletteControls">
              <label class="field">
                <span class="label">ë£°ë › í•­ëª©(ì‰¼í‘œë¡œ êµ¬ë¶„)</span>
                <textarea id="rouletteItems" rows="6"></textarea>
              </label>
              <div class="actions">
                <button id="spinBtn" class="btn primary" type="button">ìŠ¤í•€</button>
                <button id="rouletteReset" class="btn" type="button">ê¸°ë³¸ê°’</button>
              </div>
              <div id="rouletteResult" class="resultBox" aria-live="polite"></div>
            </div>
          </div>
        </section>
      </section>

      <footer class="footer">
        <p>
        </p>
      </footer>
    </main>

    <script>
      // ---- utils: seeded RNG (xorshift32) ----
      function hashStringToUint32(str) {
        let h = 2166136261;
        for (let i = 0; i < str.length; i++) {
          h ^= str.charCodeAt(i);
          h = Math.imul(h, 16777619);
        }
        return h >>> 0;
      }

      function makeRng(seedStr) {
        let x = hashStringToUint32(seedStr || "seed");
        return function rand() {
          x ^= x << 13;
          x ^= x >>> 17;
          x ^= x << 5;
          return ((x >>> 0) % 1000000) / 1000000;
        };
      }

      function shuffle(arr, rand) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(rand() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

      function qs() {
        const p = new URLSearchParams(location.search);
        return {
          seed: (p.get("seed") || "").trim(),
          tab: (p.get("tab") || "").trim(),
        };
      }

      function randomSeed() {
        const alphabet = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
        let s = "";
        const r =
          crypto && crypto.getRandomValues
            ? crypto.getRandomValues(new Uint8Array(10))
            : null;
        for (let i = 0; i < 10; i++) {
          const n = r ? r[i] : Math.floor(Math.random() * 256);
          s += alphabet[n % alphabet.length];
        }
        return s;
      }

      // ---- game data ----
      const BALANCE_QUESTIONS = [
        { a: "í‰ìƒ ì—¬ë¦„ë§Œ ì‚´ê¸°", b: "í‰ìƒ ê²¨ìš¸ë§Œ ì‚´ê¸°" },
        { a: "ì»¤í”¼ ì—†ì´ ì‚´ê¸°", b: "íƒ„ì‚° ì—†ì´ ì‚´ê¸°" },
        { a: "ì•ŒëŒ ì—†ì´ ë§¤ì¼ ëŠ¦ì ", b: "ë§¤ì¼ ì¹¼ê°™ì´ ì¼ì° ê¸°ìƒ" },
        { a: "ì—¬í–‰ì€ ë¬´ì¡°ê±´ ì¦‰í¥", b: "ì—¬í–‰ì€ ë¶„ ë‹¨ìœ„ ê³„íš" },
        { a: "ì•„ì¹¨í˜• ì¸ê°„ìœ¼ë¡œ ê°•ì œ ê°œì¡°", b: "ë°¤í˜• ì¸ê°„ìœ¼ë¡œ ê³ ì •" },
        { a: "í‰ìƒ ì¢‹ì•„í•˜ëŠ” ë…¸ë˜ 1ê³¡ë§Œ ë°˜ë³µ", b: "ë§¤ì¼ ëœë¤ ìŒì•…" },
        { a: "ì¹œêµ¬ë‘ í•­ìƒ ë¶™ì–´ ë‹¤ë‹ˆê¸°", b: "í˜¼ìë§Œì˜ ì‹œê°„ ë¬´ì œí•œ" },
        { a: "ë¹„ì£¼ì–¼ ìµœì•…Â·ë§› ë¯¸ì¹œ ìŒì‹", b: "ë¹„ì£¼ì–¼ ë¯¸ì¹œÂ·ë§› ë¬´ë‚œ" },
        { a: "í‰ìƒ ì‚¬ì§„ ì°íˆëŠ” ë‹´ë‹¹", b: "í‰ìƒ ì‚¬ì§„ ê¸°ì‚¬" },
        { a: "í‰ìƒ ê°™ì€ ë©”ë‰´ë§Œ ë¨¹ê¸°", b: "ë§¤ ë¼ë‹ˆ ëœë¤ ë©”ë‰´" },
        { a: "ì†Œì› í•œ ë²ˆì— ì˜¬ì¸", b: "ì†Œì› ì†Œì•¡ ë¶„í•  10ë²ˆ" },
        { a: "í•œ ë²ˆì— ëŒ€ë°•Â·ì§§ìŒ", b: "ì²œì²œíˆ ì„±ê³µÂ·ì˜¤ë˜ê°" },
        { a: "ë§ ì•ˆ í•´ë„ ëˆˆë¹› í†µí•¨", b: "ìˆ˜ë‹¤ í­ë°œ ì¼€ë¯¸" },
        { a: "ì§€ê¸ˆ ê¸°ì–µ ìœ ì§€í•˜ê³  ë‹¤ì‹œ íƒœì–´ë‚˜ê¸°", b: "ê¸°ì–µ ë¦¬ì…‹í•˜ê³  ë‹¤ì‹œ ì‹œì‘í•˜ê¸°" },
      ];

      const MISSION_LIST = [
        "ì˜† ì‚¬ëŒì—ê²Œ í•œ ë¬¸ì¥ ì¹­ì°¬í•˜ê¸°",
        "ìµœê·¼ ê°€ì¥ ì›ƒê²¼ë˜ ì¼ í•œ ê°€ì§€ ë§í•˜ê¸°",
        "ì˜¤ëŠ˜ ì œì¼ ë§›ìˆì—ˆë˜ ìŒì‹ ë§í•˜ê¸°",
        "ì§€ê¸ˆ ê¸°ë¶„ì„ í•œ ë‹¨ì–´ë¡œ í‘œí˜„í•˜ê¸°",
        "ì¢‹ì•„í•˜ëŠ” ì˜í™”ë‚˜ ë“œë¼ë§ˆ í•˜ë‚˜ ì¶”ì²œí•˜ê¸°",
        "ê°ì‚¬í•œ ì‚¬ëŒ í•œ ëª… ë– ì˜¬ë ¤ ë§í•˜ê¸°",
        "ìš”ì¦˜ ìì£¼ ë“£ëŠ” ë…¸ë˜ ì œëª© ë§í•˜ê¸°",
        "ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ìŒì‹ í•œ ê°€ì§€ ê³ ë¥´ê¸°",
        "íœ´ëŒ€í° ë°°ê²½í™”ë©´ ì£¼ì œë§Œ ê³µê°œí•˜ê¸°",
        "ìµœê·¼ ì†Œì†Œí•˜ê²Œ ì˜í•œ ì¼ í•˜ë‚˜ ë§í•˜ê¸°",
        "ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ì ìˆ˜ë¡œ ë§¤ê¸°ê¸° (10ì  ë§Œì )",
        "ìš”ì¦˜ ë‚˜ë¥¼ í–‰ë³µí•˜ê²Œ í•˜ëŠ” ê²ƒ í•˜ë‚˜ ë§í•˜ê¸°",
        "ë‹¤ìŒ íšŒì‹ ë•Œ í•˜ê³  ì‹¶ì€ ê²ƒ í•œ ê°€ì§€ ë§í•˜ê¸°",
        "ì§€ê¸ˆ ê°€ì¥ í•˜ê³  ì‹¶ì€ ì¼ í•œ ê°€ì§€ ë§í•˜ê¸°",
      ];

      const BINGO_PHRASES = [
        "ë§ ì—†ì´ ì±™ê²¨ì£¼ëŠ” ì‚¬ëŒ",
        "ë¶„ìœ„ê¸° ë©”ì´ì»¤",
        "ì •ë¦¬ì™•",
        "ì§ˆë¬¸ ì˜í•˜ëŠ” ì‚¬ëŒ",
        "ì„¤ëª… ì˜í•˜ëŠ” ì‚¬ëŒ",
        "ì•½ì† ì˜ ì§€í‚¤ëŠ” ì‚¬ëŒ",
        "ë°°ë ¤ê°€ ëŠê»´ì§€ëŠ” ì‚¬ëŒ",
        "í”¼ë“œë°±ì´ ë”°ëœ»í•œ ì‚¬ëŒ",
        "ì¼ì´ ë¹ ë¥¸ ì‚¬ëŒ",
        "ê¼¼ê¼¼í•œ ì‚¬ëŒ",
        "ë¬¸ì œ í•´ê²°ì‚¬",
        "ê¸ì •ì™•",
        "ì•„ì´ë””ì–´ ë±…í¬",
        "íŒ€ì„ í¸í•˜ê²Œ ë§Œë“œëŠ” ì‚¬ëŒ",
        "ì›ƒìŒ ë²„íŠ¼",
        "ë¦¬ì•¡ì…˜ ì²œì¬",
        "í•™ìŠµ ì†ë„ ë¹ ë¥¸ ì‚¬ëŒ",
        "ë„ì›€ ìš”ì²­í•˜ë©´ ë°”ë¡œ ì˜¤ëŠ” ì‚¬ëŒ",
        "ë©”ëª¨/ê¸°ë¡ ì˜í•˜ëŠ” ì‚¬ëŒ",
        "ì¹¨ì°©í•œ ì‚¬ëŒ",
        "ì„¼ìŠ¤ ìˆëŠ” ì‚¬ëŒ",
        "ë§íˆ¬ê°€ ê³ ìš´ ì‚¬ëŒ",
        "ë“£ëŠ” ê±¸ ì˜í•˜ëŠ” ì‚¬ëŒ",
        "ì±…ì„ê° ìˆëŠ” ì‚¬ëŒ",
        "ì„±ì¥ ì¤‘ì¸ ì‚¬ëŒ",
        "ë¯¿ìŒì§í•œ ì‚¬ëŒ",
        "ì¡´ì¤‘ì´ ëŠê»´ì§€ëŠ” ì‚¬ëŒ",
        "ìœ ë¨¸ ìˆëŠ” ì‚¬ëŒ",
        "í”„ë¡œë‹µê²Œ ë§ˆë¬´ë¦¬í•˜ëŠ” ì‚¬ëŒ",
        "ìƒˆë¡œìš´ ì‹œë„í•˜ëŠ” ì‚¬ëŒ",
      ];

      const DEFAULT_ROULETTE_ITEMS = [
        "ê±´ë°°ì‚¬ í•œ ë§ˆë””",
        "ì˜†ì‚¬ëŒ ì¹­ì°¬ 1ê°œ",
        "ì˜¤ëŠ˜ì˜ í•œ ì¤„ ì†Œê°",
        "ìµœê·¼ì— ì›ƒê¸´ ì¼ 1ê°œ",
        "íŒ€ì—ê²Œ ê³ ë§ˆìš´ ì  1ê°œ",
        "ë‹¤ìŒ ê²Œì„ ì„ íƒê¶Œ",
        "ë¬¼ í•œ ì” ë§ˆì‹œê¸°(ê±´ê°•)",
        "ì…€ì¹´ í¬ì¦ˆ ì œì•ˆí•˜ê¸°",
      ];

      document.addEventListener("DOMContentLoaded", () => {
        const els = {
          tabs: Array.from(document.querySelectorAll(".tab")),
          panels: {
            balance: document.getElementById("tab-balance"),
            mission: document.getElementById("tab-mission"),
            bingo: document.getElementById("tab-bingo"),
            roulette: document.getElementById("tab-roulette"),
          },

          // balance
          balanceCounter: document.getElementById("balanceCounter"),
          balanceQuestion: document.getElementById("balanceQuestion"),
          balanceA: document.getElementById("balanceA"),
          balanceB: document.getElementById("balanceB"),
          balancePrev: document.getElementById("balancePrev"),
          balanceNext: document.getElementById("balanceNext"),
          balanceShuffle: document.getElementById("balanceShuffle"),

          // mission
          missionText: document.getElementById("missionText"),
          missionPick: document.getElementById("missionPick"),
          missionAgain: document.getElementById("missionAgain"),

          // bingo
          bingoGrid: document.getElementById("bingoGrid"),
          bingoResetMarks: document.getElementById("bingoResetMarks"),
          bingoRegenerate: document.getElementById("bingoRegenerate"),

          // roulette
          wheel: document.getElementById("wheel"),
          rouletteItems: document.getElementById("rouletteItems"),
          spinBtn: document.getElementById("spinBtn"),
          rouletteReset: document.getElementById("rouletteReset"),
          rouletteResult: document.getElementById("rouletteResult"),
        };

        const state = {
          seed: "",
          balanceDeck: [],
          balanceIdx: 0,
          missionDeck: [],
          missionIdx: 0,
          bingoWords: [],
          bingoMarks: new Set(),
          wheelItems: [],
          wheelAngle: 0,
          wheelSpinning: false,
        };

        function getActiveTab() {
          const t = els.tabs.find((b) => b.classList.contains("isActive"));
          return t ? t.dataset.tab : "balance";
        }

        function setActiveTab(tab) {
          for (const b of els.tabs) {
            b.classList.toggle("isActive", b.dataset.tab === tab);
          }
          Object.entries(els.panels).forEach(([k, panel]) => {
            panel.classList.toggle("hidden", k !== tab);
          });
        }

        els.tabs.forEach((b) => {
          b.addEventListener("click", () => setActiveTab(b.dataset.tab));
        });

        // ---- balance ----
        function initBalanceDeck() {
          const rand = makeRng(`${state.seed}:balance`);
          state.balanceDeck = shuffle(BALANCE_QUESTIONS, rand);
          state.balanceIdx = 0;
          renderBalance();
        }

        function renderBalance() {
          const n = state.balanceDeck.length;
          const i = Math.max(0, Math.min(state.balanceIdx, n - 1));
          state.balanceIdx = i;
          const item = state.balanceDeck[i];
          els.balanceCounter.textContent = `${i + 1} / ${n}`;
          els.balanceQuestion.textContent = item.q || `${item.a} vs ${item.b}`;
          els.balanceA.textContent = `A) ${item.a}`;
          els.balanceB.textContent = `B) ${item.b}`;
          els.balancePrev.disabled = i === 0;
          els.balanceNext.disabled = i === n - 1;
        }

        els.balancePrev.addEventListener("click", () => {
          state.balanceIdx -= 1;
          renderBalance();
        });
        els.balanceNext.addEventListener("click", () => {
          state.balanceIdx += 1;
          renderBalance();
        });
        els.balanceShuffle.addEventListener("click", initBalanceDeck);
        els.balanceA.addEventListener("click", () => els.balanceA.blur());
        els.balanceB.addEventListener("click", () => els.balanceB.blur());

        // ---- mission ----
        function initMissionDeck() {
          const rand = makeRng(`${state.seed}:mission`);
          state.missionDeck = shuffle(MISSION_LIST, rand);
          state.missionIdx = 0;
          els.missionText.textContent = "ë²„íŠ¼ì„ ëˆŒëŸ¬ ë½‘ê¸°";
        }

        function pickMission() {
          if (!state.missionDeck.length) return;
          const item =
            state.missionDeck[state.missionIdx % state.missionDeck.length];
          state.missionIdx += 1;
          els.missionText.textContent = item;
        }

        els.missionPick.addEventListener("click", pickMission);
        els.missionAgain.addEventListener("click", pickMission);

        // ---- bingo ----
        function bingoStorageKey(seed) {
          return `dinner_bingo_marks:${seed}`;
        }

        function saveBingoMarks() {
          try {
            localStorage.setItem(
              bingoStorageKey(state.seed),
              JSON.stringify([...state.bingoMarks])
            );
          } catch (_) {}
        }

        function loadBingoMarks() {
          state.bingoMarks = new Set();
          try {
            const raw = localStorage.getItem(bingoStorageKey(state.seed));
            if (!raw) return;
            const arr = JSON.parse(raw);
            if (Array.isArray(arr)) arr.forEach((x) => state.bingoMarks.add(String(x)));
          } catch (_) {}
        }

        function initBingoCard() {
          const rand = makeRng(`${state.seed}:bingo`);
          const picks = shuffle(BINGO_PHRASES, rand).slice(0, 25);
          state.bingoWords = picks;
          loadBingoMarks();
          renderBingo();
        }

        function renderBingo() {
          els.bingoGrid.innerHTML = "";
          state.bingoWords.forEach((word, idx) => {
            const cell = document.createElement("button");
            cell.type = "button";
            cell.className = "bingoCell";
            cell.setAttribute("role", "gridcell");
            cell.dataset.key = `${idx}:${word}`;
            cell.textContent = word;
            cell.classList.toggle("isMarked", state.bingoMarks.has(cell.dataset.key));
            cell.addEventListener("click", () => {
              const key = cell.dataset.key;
              if (state.bingoMarks.has(key)) state.bingoMarks.delete(key);
              else state.bingoMarks.add(key);
              cell.classList.toggle("isMarked");
              saveBingoMarks();
            });
            els.bingoGrid.appendChild(cell);
          });
        }

        els.bingoResetMarks.addEventListener("click", () => {
          state.bingoMarks = new Set();
          saveBingoMarks();
          renderBingo();
        });

        els.bingoRegenerate.addEventListener("click", () => {
          state.seed = randomSeed();
          hydrateFromSeed();
        });

        // ---- roulette ----
        function parseRouletteItems(text) {
          return (text || "")
            .split(",")
            .map((s) => s.trim())
            .filter(Boolean);
        }

        function drawWheel() {
          const canvas = els.wheel;
          const ctx = canvas.getContext("2d");
          const w = canvas.width;
          const h = canvas.height;
          ctx.clearRect(0, 0, w, h);

          const items = state.wheelItems.length ? state.wheelItems : ["-"];
          const n = items.length;
          const cx = w / 2;
          const cy = h / 2;
          const r = Math.min(w, h) / 2 - 10;

          // pointer
          ctx.save();
          ctx.translate(cx, cy);
          ctx.fillStyle = "rgba(255,255,255,0.9)";
          ctx.beginPath();
          ctx.moveTo(0, -r - 6);
          ctx.lineTo(-10, -r + 12);
          ctx.lineTo(10, -r + 12);
          ctx.closePath();
          ctx.fill();
          ctx.restore();

          // wheel
          ctx.save();
          ctx.translate(cx, cy);
          ctx.rotate(state.wheelAngle);

          for (let i = 0; i < n; i++) {
            const start = (i * 2 * Math.PI) / n;
            const end = ((i + 1) * 2 * Math.PI) / n;
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.arc(0, 0, r, start, end);
            ctx.closePath();
            const hue = (i * 360) / n;
            ctx.fillStyle = `hsla(${hue}, 70%, 55%, 0.55)`;
            ctx.fill();
            ctx.strokeStyle = "rgba(255,255,255,0.12)";
            ctx.stroke();

            ctx.save();
            ctx.rotate(start + (end - start) / 2);
            ctx.fillStyle = "rgba(255,255,255,0.92)";
            ctx.font = "700 13px 'Noto Sans KR', sans-serif";
            ctx.textAlign = "right";
            ctx.textBaseline = "middle";
            const label = items[i].length > 16 ? `${items[i].slice(0, 15)}â€¦` : items[i];
            ctx.fillText(label, r - 10, 0);
            ctx.restore();
          }

          ctx.beginPath();
          ctx.arc(0, 0, 18, 0, Math.PI * 2);
          ctx.fillStyle = "rgba(10, 16, 34, 0.75)";
          ctx.fill();
          ctx.strokeStyle = "rgba(255,255,255,0.18)";
          ctx.stroke();

          ctx.restore();
        }

        function getSelectedWheelItem() {
          const items = state.wheelItems;
          if (!items.length) return "";
          const n = items.length;
          const a = (-(state.wheelAngle) + Math.PI / 2) % (Math.PI * 2);
          const norm = (a + Math.PI * 2) % (Math.PI * 2);
          const idx = Math.floor((norm / (Math.PI * 2)) * n) % n;
          return items[idx];
        }

        function spinWheel() {
          if (state.wheelSpinning) return;
          state.wheelSpinning = true;
          els.spinBtn.disabled = true;
          els.rouletteResult.textContent = "ëŒë¦¬ëŠ” ì¤‘â€¦";

          const rand = makeRng(`${state.seed}:roulette:${Date.now()}`);
          const extra = Math.PI * 2 * (4 + Math.floor(rand() * 3));
          const target = Math.PI * 2 * rand();
          const startAngle = state.wheelAngle;
          const endAngle = startAngle + extra + target;
          const duration = 2300;
          const start = performance.now();

          function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
          }

          function frame(now) {
            const t = Math.min(1, (now - start) / duration);
            state.wheelAngle =
              startAngle + (endAngle - startAngle) * easeOutCubic(t);
            drawWheel();
            if (t < 1) requestAnimationFrame(frame);
            else {
              state.wheelSpinning = false;
              els.spinBtn.disabled = false;
              const picked = getSelectedWheelItem();
              els.rouletteResult.textContent = picked ? `ê²°ê³¼: ${picked}` : "ê²°ê³¼ ì—†ìŒ";
            }
          }

          requestAnimationFrame(frame);
        }

        function setRouletteItems(items) {
          state.wheelItems = items;
          els.rouletteItems.value = items.join(", ");
          drawWheel();
          els.rouletteResult.textContent = "";
        }

        els.spinBtn.addEventListener("click", () => {
          state.wheelItems = parseRouletteItems(els.rouletteItems.value);
          drawWheel();
          spinWheel();
        });

        els.rouletteReset.addEventListener("click", () => {
          setRouletteItems(DEFAULT_ROULETTE_ITEMS);
        });

        // ---- hydrate ----
        function hydrateFromSeed() {
          initBalanceDeck();
          initMissionDeck();
          initBingoCard();

          const key = `dinner_roulette_items:${state.seed}`;
          let saved = null;
          try {
            saved = JSON.parse(localStorage.getItem(key) || "null");
          } catch (_) {
            saved = null;
          }
          const items = Array.isArray(saved) && saved.length ? saved : DEFAULT_ROULETTE_ITEMS;
          setRouletteItems(items);

          els.rouletteItems.addEventListener("change", () => {
            const next = parseRouletteItems(els.rouletteItems.value);
            try {
              localStorage.setItem(key, JSON.stringify(next));
            } catch (_) {}
          });
        }

        // ---- boot ----
        const { seed, tab } = qs();
        state.seed = seed || randomSeed();
        hydrateFromSeed();
        setActiveTab(tab || "balance");
      });
    </script>
  </body>
</html>




